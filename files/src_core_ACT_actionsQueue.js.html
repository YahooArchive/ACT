<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/core/ACT_actionsQueue.js - ACT.js</title>
    <link rel="stylesheet" href="https://s.yimg.com/zz/combo?yui-s:3.14.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="https://s.yimg.com/rz/l/favicon.ico">
    <script src="https://s.yimg.com/zz/combo?yui-s:3.14.1/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="https://s.yimg.com/cv/ae/global/ACTJS/logo/ACT.js.logo.png" title="ACT.js" width="126" height="100"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.22</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                            <li><a href="#api-demos">Demo and Examples</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ACT.html">ACT</a></li>
                                <li><a href="../classes/ActionsQueue.html">ActionsQueue</a></li>
                                <li><a href="../classes/Base.html">Base</a></li>
                                <li><a href="../classes/Capability.html">Capability</a></li>
                                <li><a href="../classes/CapabilitySkeleton.html">CapabilitySkeleton</a></li>
                                <li><a href="../classes/Class.html">Class</a></li>
                                <li><a href="../classes/ContentAdfeedback.html">ContentAdfeedback</a></li>
                                <li><a href="../classes/ContentAdobeEdge.html">ContentAdobeEdge</a></li>
                                <li><a href="../classes/ContentCarousel.html">ContentCarousel</a></li>
                                <li><a href="../classes/ContentContainer.html">ContentContainer</a></li>
                                <li><a href="../classes/ContentHtml5.html">ContentHtml5</a></li>
                                <li><a href="../classes/ContentImage.html">ContentImage</a></li>
                                <li><a href="../classes/ContentProgressBar.html">ContentProgressBar</a></li>
                                <li><a href="../classes/ContentSwf.html">ContentSwf</a></li>
                                <li><a href="../classes/ContentThirdParty.html">ContentThirdParty</a></li>
                                <li><a href="../classes/ContentVideoFlash.html">ContentVideoFlash</a></li>
                                <li><a href="../classes/ContentVideoHtml.html">ContentVideoHtml</a></li>
                                <li><a href="../classes/ContentYoutube.html">ContentYoutube</a></li>
                                <li><a href="../classes/ContentYtv.html">ContentYtv</a></li>
                                <li><a href="../classes/Cookie.html">Cookie</a></li>
                                <li><a href="../classes/CustomData.html">CustomData</a></li>
                                <li><a href="../classes/Debug.html">Debug</a></li>
                                <li><a href="../classes/Dom.html">Dom</a></li>
                                <li><a href="../classes/DwellTime.html">DwellTime</a></li>
                                <li><a href="../classes/Enabler.html">Enabler</a></li>
                                <li><a href="../classes/Environment.html">Environment</a></li>
                                <li><a href="../classes/Event.html">Event</a></li>
                                <li><a href="../classes/Flash.html">Flash</a></li>
                                <li><a href="../classes/IO.html">IO</a></li>
                                <li><a href="../classes/Json.html">Json</a></li>
                                <li><a href="../classes/Lang.html">Lang</a></li>
                                <li><a href="../classes/LayersList.html">LayersList</a></li>
                                <li><a href="../classes/LayerStandard.html">LayerStandard</a></li>
                                <li><a href="../classes/Scaffolding.html">Scaffolding</a></li>
                                <li><a href="../classes/Screen.html">Screen</a></li>
                                <li><a href="../classes/SecureDarla.html">SecureDarla</a></li>
                                <li><a href="../classes/StandardAd.html">StandardAd</a></li>
                                <li><a href="../classes/Tracking.html">Tracking</a></li>
                                <li><a href="../classes/UA.html">UA</a></li>
                                <li><a href="../classes/Util.html">Util</a></li>
                                <li><a href="../classes/VideoEvents.html">VideoEvents</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ACT.html">ACT</a></li>
                                <li><a href="../modules/actionsQueue.html">actionsQueue</a></li>
                                <li><a href="../modules/Base.html">Base</a></li>
                                <li><a href="../modules/CapabilitySkeleton.html">CapabilitySkeleton</a></li>
                                <li><a href="../modules/ContentAdfeedback.html">ContentAdfeedback</a></li>
                                <li><a href="../modules/ContentAdobeEdge.html">ContentAdobeEdge</a></li>
                                <li><a href="../modules/ContentCarousel.html">ContentCarousel</a></li>
                                <li><a href="../modules/ContentContainer.html">ContentContainer</a></li>
                                <li><a href="../modules/ContentHtml5.html">ContentHtml5</a></li>
                                <li><a href="../modules/ContentImage.html">ContentImage</a></li>
                                <li><a href="../modules/ContentProgressBar.html">ContentProgressBar</a></li>
                                <li><a href="../modules/ContentSwf.html">ContentSwf</a></li>
                                <li><a href="../modules/ContentThirdParty.html">ContentThirdParty</a></li>
                                <li><a href="../modules/ContentVideoFlash.html">ContentVideoFlash</a></li>
                                <li><a href="../modules/ContentVideoHtml.html">ContentVideoHtml</a></li>
                                <li><a href="../modules/ContentYoutube.html">ContentYoutube</a></li>
                                <li><a href="../modules/ContentYtv.html">ContentYtv</a></li>
                                <li><a href="../modules/Cookie.html">Cookie</a></li>
                                <li><a href="../modules/DwellTime.html">DwellTime</a></li>
                                <li><a href="../modules/Enabler.html">Enabler</a></li>
                                <li><a href="../modules/environment.html">environment</a></li>
                                <li><a href="../modules/IO.html">IO</a></li>
                                <li><a href="../modules/LayersList.html">LayersList</a></li>
                                <li><a href="../modules/LayerStandard.html">LayerStandard</a></li>
                                <li><a href="../modules/Scaffolding.html">Scaffolding</a></li>
                                <li><a href="../modules/Screen.html">Screen</a></li>
                                <li><a href="../modules/SecureDarla.html">SecureDarla</a></li>
                                <li><a href="../modules/StandardAd.html">StandardAd</a></li>
                                <li><a href="../modules/Tracking.html">Tracking</a></li>
                            </ul>
                
                            <ul id="api-demos" class="apis demos">
                                <li><a href="../demo/ACT_Demo_300x250.html">300x250</a></li>
                                <li><a href="../demo/ACT_Demo_300x250_tracking.html">300x250_tracking</a></li>
                                <li><a href="../demo/ACT_Demo_TrackingExample.html">TrackingExample</a></li>
                                <li><a href="../demo/ACT_Demo_animation.html">animation</a></li>
                                <li><a href="../demo/ACT_Demo_billboard.html">billboard</a></li>
                                <li><a href="../demo/ACT_Demo_billboard-enabler.html">billboard-enabler</a></li>
                                <li><a href="../demo/ACT_Demo_billboard-expandable-enabler.html">billboard-expandable-enabler</a></li>
                                <li><a href="../demo/ACT_Demo_billboard_html_video.html">billboard_html_video</a></li>
                                <li><a href="../demo/ACT_Demo_billboard_html_video_rtl.html">billboard_html_video_rtl</a></li>
                                <li><a href="../demo/ACT_Demo_carousel.html">carousel</a></li>
                                <li><a href="../demo/ACT_Demo_dwelltime.html">dwelltime</a></li>
                                <li><a href="../demo/ACT_Demo_enabler_expand.html">enabler_expand</a></li>
                                <li><a href="../demo/ACT_Demo_enabler_fullscreen_expand.html">enabler_fullscreen_expand</a></li>
                                <li><a href="../demo/ACT_Demo_enabler_target.html">enabler_target</a></li>
                                <li><a href="../demo/ACT_Demo_floating.html">floating</a></li>
                                <li><a href="../demo/ACT_Demo_force_env.html">force_env</a></li>
                                <li><a href="../demo/ACT_Demo_html5_enabler.html">html5_enabler</a></li>
                                <li><a href="../demo/ACT_Demo_html5_standard.html">html5_standard</a></li>
                                <li><a href="../demo/ACT_Demo_icons.html">icons</a></li>
                                <li><a href="../demo/ACT_Demo_input_data.html">input_data</a></li>
                                <li><a href="../demo/ACT_Demo_login_html.html">login_html</a></li>
                                <li><a href="../demo/ACT_Demo_overwrite_env.html">overwrite_env</a></li>
                                <li><a href="../demo/ACT_Demo_splash_ad.html">splash_ad</a></li>
                                <li><a href="../demo/ACT_Demo_tablet_expandable.html">tablet_expandable</a></li>
                                <li><a href="../demo/ACT_Demo_video_event.html">video_event</a></li>
                                <li><a href="../demo/ACT_Demo_video_html.html">video_html</a></li>
                            </ul>
                
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/core/ACT_actionsQueue.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
 * Copyright 2016, Yahoo Inc.
 * Copyrights licensed under the New BSD License.
 * See the accompanying LICENSE file for terms.
 */

/* global ACT */
/**
 * Creates a new queue. A queue is a first-in-first-out (FIFO) data structure -
 * items are added to the end of the queue and removed from the front.
 * &lt;br/&gt;
 * Provide features:
 * - register action definition
 * - Add action to queue to be executed
 *
 * Action definition must be registered first like below example:
 *
 *     ACT.fire(&#x27;register:Actions&#x27;,
 *        {
 *            type: &#x27;action_name&#x27;, // must be unique name
 *            argument: {
 *                // list of argument accepted by this actions
 *                arg1: {
 *                    test: function(value) {
 *                        // function to check the value of arg1
 *                        // must return true or false
 *                        return true;
 *                    }
 *                },
 *                arg2: {
 *                    test: function(value) {
 *                        // function to check the value of arg2
 *                        // must return true or false
 *                        return true;
 *                    }
 *                }
 *             },
 *            proccess: function(data) {
 *                 //function to be executed when action is executed
 *                // data is an object with passed arguments, e.g:
 *                var arg1 = data.arg1;
 *                var arg2 = data.arg2;
 *            }
 *        }
 *     );
 *
 * After registered, action can be execute by adding it to actions queue:
 *
 *     ACT.fire(&#x27;add:action&#x27;,
 *        {
 *            type: &#x27;unique_action_name&#x27;,
 *            arg1: [value], // value for arg1 must satify arg1&#x27;s test function in action definition
 *            arg2: [value], // value for arg2 must satify arg2&#x27;s test function in action definition
 *         }
 *     );
 *
 * As the queue work in async order, complete:action event must be fired before the next action can be executed
 *
 *        ACT.fire(&#x27;complete:action&#x27;);
 *
 * @module actionsQueue
 * @main ActionsQueue
 * @class ActionsQueue
 * @requires event,lang
 * @global
 */
ACT.define(&#x27;ActionsQueue&#x27;, [/*@&lt;*/&#x27;Debug&#x27;, /*&gt;@*/ &#x27;Event&#x27;, &#x27;Lang&#x27;, &#x27;Class&#x27;], function (ACT) {
    &#x27;use strict&#x27;;

    /* Shorthand */
    var Lang = ACT.Lang;
    var Event = ACT.Event;
    var Class = ACT.Class;
    /*@&lt;*/
    var Debug = ACT.Debug;
    /*&gt;@*/

    /**
     * @constructor
     * @param {Object} config ConfigObject to initialize ActionQueues
     */
    function ActionsQueue(config) {
        this.init(config);
    }

    ActionsQueue.ATTRS = {
        /**
         * @attribute NAME
         * @type String
         */
        NAME: &#x27;ActionsQueue&#x27;,

        /**
         * @attribute version
         * @type String
         */
        version: &#x27;1.0.41&#x27;,

        /**
         * List of actions have been registered
         * Only actions in this list is executable
         *
         * @attribute registeredActions
         * @type Object
         */
        registeredActions: {},

        /**
         * Queue for actions to be executed. This queue is processed with FIFO
         *
         * @attribute executeQueue
         * @type Array
         */
        executeQueue: [],

        /**
         * Flag for executing action. False means no action is executed at the moment and queue can run
         *
         * @attribute isRunning
         * @type Boolean
         * @default false
         */
        isRunning: false,

        /**
         * Current executing action
         *
         * @attribute currentAction
         * @type Object
         * default null
         */
        currentAction: null,

        /**
         * setTimeout function variable
         * @attribute timer
         * @type Object
         * default null
        */
        timer: null,

        /**
         * timeout (in seconds) for executing an action
         * @attribute actionTimeout
         * @type Number
         * default 1
         */
        actionTimeout: 0,

        /**
         * latest queue position Id
         * @attribute positionId
         * @type Number
         * default 0
        */
        positionId: 0

    };

    Lang.extend(ActionsQueue, Class, {

        initializer: function () {
              var root = this;

              /* istanbul ignore next */
            root.addEventListeners(
                /**
                 * @event register:Actions
                 * @param {Array | Object} List of actions&#x27; definition to be registered
                 */
                Event.on(&#x27;register:Actions&#x27;, function (eventData) {
                    root.registerActions(eventData);
                }),

                /**
                 * @event add:actions
                 * @param {Array | Object} List of actions to be execute
                 */
                Event.on(&#x27;add:actions&#x27;, function (eventData) {
                    root.addActions(eventData);
                }),

                /**
                 * @event complete:action
                 */
                Event.on(&#x27;complete:action&#x27;, function (queuePositionId) {
                    root.completeAction(queuePositionId);
                }),

                Event.on(&#x27;setTimeout:action&#x27;, function (eventData) {
                    root.setActionTimeout(eventData.actionTimeout);
                })
            );
        },

        /**
         * Register list of actions into ActionsQueue so it can be executable.
         *
         * @method registerActions
         * @param [Array | Object] actions List of actions&#x27; definition to be registered
         */
        registerActions: function (actions) {
            var registeredActions = this.get(&#x27;registeredActions&#x27;);
            var index;
            var action;
            /*@&lt;*/
            Debug.log(&#x27;[ ACT_actionsQueue.js ] ActionQueue:New register actions&#x27;, actions);
            /*&gt;@*/

            // run through all actions and add it to registeredActions list
            if (Lang.isArray(actions)) {
                for (index = 0; index &lt; actions.length; index++) {
                    action = actions[index];
                    registeredActions[action.type] = action;
                }
                this.set(&#x27;registeredActions&#x27;, registeredActions);
            } else if (Lang.isObject(actions)) {
                registeredActions[actions.type] = actions;
                this.set(&#x27;registeredActions&#x27;, registeredActions);
            } else {
                return false;
            }

            return true;
        },

        /**
         * Adding list of actions (or single action ) into the queue.
         * If the input is Array then it&#x27;s a list of action
         * If the input is Object then it&#x27;s a single action
         *
         * @method addActions
         * @param {Array | Object} actions List of actions or an action
         * @return {Boolean} true if input is valid
         */
        addActions: function (actions) {
            var i;
            /*@&lt;*/
            Debug.log(&#x27;[ ACT_actionsQueue.js ] ActionQueue: add actions in for loop&#x27;, actions);
            /*&gt;@*/

            // if input is an array then go through every item and push it into the queue
            // if input is an object then push this to the queue as an actions
            // other than that, it&#x27;s an invalid input then shoud do nothing
            if (Lang.isArray(actions)) {
                for (i = 0; i &lt; actions.length; i++) {
                    this.enqueue(actions[i]);
                }
            } else if (Lang.isObject(actions)) {
                this.enqueue(actions);
            } else {
                return false;
            }

            // let&#x27;s try to start the queue
            this.runQueue();

            return true;
        },

        /**
         * Checking if arguments come with the action are satisfied with action definition
         *
         * @method isActionArgumentsValid
         * @param {Object} action Action to be assessed
         * @return {Boolean} true if action is valid
         */
        isActionArgumentsValid: function (action) {
            var actionDefinition = this.get(&#x27;registeredActions&#x27;)[action.type];
            var result = true;
            var argDefinition;

            if (actionDefinition) {
                result = true;
                argDefinition = actionDefinition.argument;
                Lang.forEach(argDefinition, function (param, definition) {
                    if (Lang.isFunction(definition.test) &amp;&amp; !definition.test(action[param])) {
                        /*@&lt;*/
                        Debug.log(&#x27;[ ACT_actionsQueue.js ] ActionQueue: Action &#x27; + action.type + &#x27; failed test for argument &#x27; + definition + &#x27; with param&#x27; + param);
                        /*&gt;@*/
                        result = false;
                    }
                });
            } else {
                result = false;
            }

            return result;
        },

        /**
         * Function to execute given action
         *
         * @method executeAction
         * @param {Object} action Action to be executed
         */
        executeAction: function (queuePositionId, action) {
            var actionDefinition;
            if (this.isActionArgumentsValid(action)) {
                /*@&lt;*/
                Debug.log(&#x27;[ ACT_actionsQueue.js ] ActionQueue: execute action &#x27;, action);
                /*&gt;@*/
                actionDefinition = this.get(&#x27;registeredActions&#x27;)[action.type];
                // call action&#x27;s process function
                this.startTimeout(queuePositionId, action.type, action.timeout);
                this.currentAction = action;
                actionDefinition.process(queuePositionId, action);
                return true;
            }
            /*@&lt;*/
            Debug.warn(&#x27; [ ACT_actionsQueue.js ] Cannot run action&#x27;, action);
            /*&gt;@*/
            this.completeAction(queuePositionId);
            return false;
        },

        /**
         * Checking if action is valid
         * action is valid if:
         *    is an object
         *    has type
         *    type is registered in registeredActions
         *
         * @method isValidAction
         * @param {Object} action Action to be verified
         */
        isValidAction: function (action) {
            // return Lang.isObject(action) &amp;&amp; Lang.isString(action.type) &amp;&amp; Lang.objHasKey(this.registeredActions, action.type);
            return Lang.isObject(action) &amp;&amp; Lang.isString(action.type);
        },

        /**
         * Push item to the end of the queue
         * @method enqueue
         * @param {Object} action Action to be push into the queue
         */
        enqueue: function (action) {
            var executeQueue = this.get(&#x27;executeQueue&#x27;);
            var actionId;
            // check if action is valid then add it to the end of the queue
            if (this.isValidAction(action)) {
                actionId = this.get(&#x27;positionId&#x27;);
                executeQueue.push({ id: actionId, action: action });
                this.set(&#x27;executeQueue&#x27;, executeQueue);
                actionId++;
                this.set(&#x27;positionId&#x27;, actionId);
            }
        },

        /**
         * Removes the specified item (by queuePositionId) out of the queue
         * @method dequeue
         * @return {Object} First item on the actions queue
         */
        dequeue: function (queuePositionId) {
            // get item at position 0
            var queue = this.get(&#x27;executeQueue&#x27;);
            var i;

            for (i = 0; i &lt; queue.length; i++) {
                if (queue[i].id === queuePositionId) {
                    queue.splice(i, 1);
                }
            }
            this.set(&#x27;executeQueue&#x27;, queue);
        },

        /**
         * Run the queue by getting the first item in the queue and execute this
         * To make sure the queue is running syncronym, a running flag will be checked before executing any action
         *
         * @method runQueue
         */
        runQueue: function () {
            // checking flag to make sure no other action is executed
            // dequeue to get new action for execution - need to check if there is action to be executed
            // turn on running flag
            // execute action
            var executeQueue = this.get(&#x27;executeQueue&#x27;);
            var action;
            /*@&lt;*/
            Debug.log(&#x27;[ ACT_actionsQueue.js ] ActionQueue: is running:&#x27;, this.isRunning);
            /*&gt;@*/

            if (!this.isRunning) {
                action = executeQueue[0] || null;
                /*@&lt;*/
                Debug.log(&#x27;[ ACT_actionsQueue.js ] ActionQueue: about to execute: &#x27;, action);
                /*&gt;@*/
                if (action !== null) {
                    this.isRunning = true;
                    this.executeAction(action.id, action.action);
                } else {
                    this.currentAction = null;
                }
            }
        },

        /**
         * Notify to queue that the current executing action has finished and ready for the next one
         *
         * @method completeAction
         */
        completeAction: function (queuePositionId) {
            /*@&lt;*/
            Debug.log(&#x27;[ ACT_actionsQueue.js ] ActionQueue: Action completed - &#x27; + this.get(&#x27;executeQueue&#x27;).length + &#x27; actions left to do&#x27;);
            /*&gt;@*/
            // when action is complete then turn off running flag and try to runQueue again
            this.isRunning = false;
            this.dequeue(queuePositionId);
            clearTimeout(this.timer);
            this.runQueue();
        },


        /**
         * set the global timeout value
         *
         * @method setActionTimeout
         * @param {Number} timeoutValue global timeout value to apply to timer
         */
        setActionTimeout: function (timeoutValue) {
            this.set(&#x27;actionTimeout&#x27;, parseInt(timeoutValue, 10));
        },

        /**
         * start the timeout
         *
         * @method startTimeout
         * @param {String} actionType action Type using the timer
         * @param {Number} timeout timeout value to apply to timer
         */
        startTimeout: function (queuePositionId, actionType, timeout) {
            var root = this;
            var positionId = queuePositionId;
            var timer = root.get(&#x27;timer&#x27;);
            var setTimeoutVal;
            var time;

            timeout = parseInt(timeout, 10);

            if (timeout === 0) {
                setTimeoutVal = 0;
            } else {
                setTimeoutVal = timeout || this.get(&#x27;actionTimeout&#x27;);
            }

            time = parseInt(setTimeoutVal, 10) * 1000;

            if (timer &gt; 0) {
                clearTimeout(timer);
                root.set(&#x27;timer&#x27;, timer);
            }

            if (time === 0) {
                return;
            }

            timer = setTimeout(function () {
                /* TODO: Switch this to a run-time error. */
                /*@&lt;*/
                Debug.log(&#x27;[ ACT_actionsQueue.js ] ActionQueue: Action &#x27; + actionType + &#x27; timed out at &#x27; + setTimeoutVal + &#x27; seconds&#x27;);
                /*&gt;@*/
                root.completeAction(positionId);
            }, time);
            this.set(&#x27;timer&#x27;, timer);
        },

        /**
         * Function to be called when the instance is destroyed
         *
         * @method destructor
         */
        destructor: function () {
            clearTimeout(this.get(&#x27;timer&#x27;));
            this.set(&#x27;executeQueue&#x27;, []);
            this.set(&#x27;registeredActions&#x27;, {});
        }
    });

    return ActionsQueue;
});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
