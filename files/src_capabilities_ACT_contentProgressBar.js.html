<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/capabilities/ACT_contentProgressBar.js - ACT.js</title>
    <link rel="stylesheet" href="https://s.yimg.com/zz/combo?yui-s:3.14.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="https://s.yimg.com/rz/l/favicon.ico">
    <script src="https://s.yimg.com/zz/combo?yui-s:3.14.1/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="https://s.yimg.com/cv/ae/global/ACTJS/logo/ACT.js.logo.png" title="ACT.js" width="126" height="100"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.22</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                            <li><a href="#api-demos">Demo and Examples</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ACT.html">ACT</a></li>
                                <li><a href="../classes/ActionsQueue.html">ActionsQueue</a></li>
                                <li><a href="../classes/Base.html">Base</a></li>
                                <li><a href="../classes/Capability.html">Capability</a></li>
                                <li><a href="../classes/CapabilitySkeleton.html">CapabilitySkeleton</a></li>
                                <li><a href="../classes/Class.html">Class</a></li>
                                <li><a href="../classes/ContentAdfeedback.html">ContentAdfeedback</a></li>
                                <li><a href="../classes/ContentAdobeEdge.html">ContentAdobeEdge</a></li>
                                <li><a href="../classes/ContentCarousel.html">ContentCarousel</a></li>
                                <li><a href="../classes/ContentContainer.html">ContentContainer</a></li>
                                <li><a href="../classes/ContentHtml5.html">ContentHtml5</a></li>
                                <li><a href="../classes/ContentImage.html">ContentImage</a></li>
                                <li><a href="../classes/ContentProgressBar.html">ContentProgressBar</a></li>
                                <li><a href="../classes/ContentSwf.html">ContentSwf</a></li>
                                <li><a href="../classes/ContentThirdParty.html">ContentThirdParty</a></li>
                                <li><a href="../classes/ContentVideoFlash.html">ContentVideoFlash</a></li>
                                <li><a href="../classes/ContentVideoHtml.html">ContentVideoHtml</a></li>
                                <li><a href="../classes/ContentYoutube.html">ContentYoutube</a></li>
                                <li><a href="../classes/ContentYtv.html">ContentYtv</a></li>
                                <li><a href="../classes/Cookie.html">Cookie</a></li>
                                <li><a href="../classes/CustomData.html">CustomData</a></li>
                                <li><a href="../classes/Debug.html">Debug</a></li>
                                <li><a href="../classes/Dom.html">Dom</a></li>
                                <li><a href="../classes/DwellTime.html">DwellTime</a></li>
                                <li><a href="../classes/Enabler.html">Enabler</a></li>
                                <li><a href="../classes/Environment.html">Environment</a></li>
                                <li><a href="../classes/Event.html">Event</a></li>
                                <li><a href="../classes/Flash.html">Flash</a></li>
                                <li><a href="../classes/IO.html">IO</a></li>
                                <li><a href="../classes/Json.html">Json</a></li>
                                <li><a href="../classes/Lang.html">Lang</a></li>
                                <li><a href="../classes/LayersList.html">LayersList</a></li>
                                <li><a href="../classes/LayerStandard.html">LayerStandard</a></li>
                                <li><a href="../classes/Scaffolding.html">Scaffolding</a></li>
                                <li><a href="../classes/Screen.html">Screen</a></li>
                                <li><a href="../classes/SecureDarla.html">SecureDarla</a></li>
                                <li><a href="../classes/StandardAd.html">StandardAd</a></li>
                                <li><a href="../classes/Tracking.html">Tracking</a></li>
                                <li><a href="../classes/UA.html">UA</a></li>
                                <li><a href="../classes/Util.html">Util</a></li>
                                <li><a href="../classes/VideoEvents.html">VideoEvents</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ACT.html">ACT</a></li>
                                <li><a href="../modules/actionsQueue.html">actionsQueue</a></li>
                                <li><a href="../modules/Base.html">Base</a></li>
                                <li><a href="../modules/CapabilitySkeleton.html">CapabilitySkeleton</a></li>
                                <li><a href="../modules/ContentAdfeedback.html">ContentAdfeedback</a></li>
                                <li><a href="../modules/ContentAdobeEdge.html">ContentAdobeEdge</a></li>
                                <li><a href="../modules/ContentCarousel.html">ContentCarousel</a></li>
                                <li><a href="../modules/ContentContainer.html">ContentContainer</a></li>
                                <li><a href="../modules/ContentHtml5.html">ContentHtml5</a></li>
                                <li><a href="../modules/ContentImage.html">ContentImage</a></li>
                                <li><a href="../modules/ContentProgressBar.html">ContentProgressBar</a></li>
                                <li><a href="../modules/ContentSwf.html">ContentSwf</a></li>
                                <li><a href="../modules/ContentThirdParty.html">ContentThirdParty</a></li>
                                <li><a href="../modules/ContentVideoFlash.html">ContentVideoFlash</a></li>
                                <li><a href="../modules/ContentVideoHtml.html">ContentVideoHtml</a></li>
                                <li><a href="../modules/ContentYoutube.html">ContentYoutube</a></li>
                                <li><a href="../modules/ContentYtv.html">ContentYtv</a></li>
                                <li><a href="../modules/Cookie.html">Cookie</a></li>
                                <li><a href="../modules/DwellTime.html">DwellTime</a></li>
                                <li><a href="../modules/Enabler.html">Enabler</a></li>
                                <li><a href="../modules/environment.html">environment</a></li>
                                <li><a href="../modules/IO.html">IO</a></li>
                                <li><a href="../modules/LayersList.html">LayersList</a></li>
                                <li><a href="../modules/LayerStandard.html">LayerStandard</a></li>
                                <li><a href="../modules/Scaffolding.html">Scaffolding</a></li>
                                <li><a href="../modules/Screen.html">Screen</a></li>
                                <li><a href="../modules/SecureDarla.html">SecureDarla</a></li>
                                <li><a href="../modules/StandardAd.html">StandardAd</a></li>
                                <li><a href="../modules/Tracking.html">Tracking</a></li>
                            </ul>
                
                            <ul id="api-demos" class="apis demos">
                                <li><a href="../demo/ACT_Demo_300x250.html">300x250</a></li>
                                <li><a href="../demo/ACT_Demo_300x250_tracking.html">300x250_tracking</a></li>
                                <li><a href="../demo/ACT_Demo_TrackingExample.html">TrackingExample</a></li>
                                <li><a href="../demo/ACT_Demo_animation.html">animation</a></li>
                                <li><a href="../demo/ACT_Demo_billboard.html">billboard</a></li>
                                <li><a href="../demo/ACT_Demo_billboard-enabler.html">billboard-enabler</a></li>
                                <li><a href="../demo/ACT_Demo_billboard-expandable-enabler.html">billboard-expandable-enabler</a></li>
                                <li><a href="../demo/ACT_Demo_billboard_html_video.html">billboard_html_video</a></li>
                                <li><a href="../demo/ACT_Demo_billboard_html_video_rtl.html">billboard_html_video_rtl</a></li>
                                <li><a href="../demo/ACT_Demo_carousel.html">carousel</a></li>
                                <li><a href="../demo/ACT_Demo_dwelltime.html">dwelltime</a></li>
                                <li><a href="../demo/ACT_Demo_enabler_expand.html">enabler_expand</a></li>
                                <li><a href="../demo/ACT_Demo_enabler_fullscreen_expand.html">enabler_fullscreen_expand</a></li>
                                <li><a href="../demo/ACT_Demo_enabler_target.html">enabler_target</a></li>
                                <li><a href="../demo/ACT_Demo_floating.html">floating</a></li>
                                <li><a href="../demo/ACT_Demo_force_env.html">force_env</a></li>
                                <li><a href="../demo/ACT_Demo_html5_enabler.html">html5_enabler</a></li>
                                <li><a href="../demo/ACT_Demo_html5_standard.html">html5_standard</a></li>
                                <li><a href="../demo/ACT_Demo_icons.html">icons</a></li>
                                <li><a href="../demo/ACT_Demo_input_data.html">input_data</a></li>
                                <li><a href="../demo/ACT_Demo_login_html.html">login_html</a></li>
                                <li><a href="../demo/ACT_Demo_overwrite_env.html">overwrite_env</a></li>
                                <li><a href="../demo/ACT_Demo_splash_ad.html">splash_ad</a></li>
                                <li><a href="../demo/ACT_Demo_tablet_expandable.html">tablet_expandable</a></li>
                                <li><a href="../demo/ACT_Demo_video_event.html">video_event</a></li>
                                <li><a href="../demo/ACT_Demo_video_html.html">video_html</a></li>
                            </ul>
                
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/capabilities/ACT_contentProgressBar.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
 * Copyright 2016, Yahoo Inc.
 * Copyrights licensed under the New BSD License.
 * See the accompanying LICENSE file for terms.
 */

/* global ACT */
/**
 * The &#x27;ContentProgressBar&#x27; is a capability made to generate a progress bar and sync it with a targeted element.
 *
 * Example of &#x27;SuperConf&#x27; use case:
 *
 *      {
 *          id: &#x27;video_progressbar&#x27;,
 *          type: &#x27;content-progressbar&#x27;,
 *          env: [&#x27;html&#x27;, &#x27;backup&#x27;],
 *          css: {
 *              width: &#x27;900px&#x27;,
 *          },
 *          progressBarConfig: {
 *              value: 0, // initial value of progress bar
 *              sourceId: &#x27;videoPlayer&#x27; // id of video element
 *          }
 *      }
 *
 * @module ContentProgressBar
 * @main ContentProgressBar
 * @class ContentProgressBar
 * @requires Dom, Lang, Event, Class, Capability
 * @global
 */
ACT.define(&#x27;ContentProgressBar&#x27;, [/*@&lt;*/&#x27;Debug&#x27;, /*&gt;@*/ &#x27;Dom&#x27;, &#x27;Lang&#x27;, &#x27;Event&#x27;, &#x27;Class&#x27;, &#x27;Capability&#x27;], function (ACT) {
    &#x27;use strict&#x27;;

    /* Constants */
    var Dom = ACT.Dom;
    var Lang = ACT.Lang;
    var Event = ACT.Event;
    var Class = ACT.Class;
    var Capability = ACT.Capability;

    /* CONSTANT VALUES */
    // millisecond between each times we try to detect the source DOM element
    var LEAP_DETECT_TIME = 100; // milliseconds
    // maximum times we allow to run the detect source DOM element
    var MAX_DETECT_TIMES = 600; // =&gt; similar to 1 minute

    /*@&lt;*/
    var Debug = ACT.Debug;
    var debugLog = function (message) {
        Debug.log(&#x27;[ ACT_contentProgressBar ]: &#x27; + message);
    };
    debugLog(&#x27;Loaded&#x27;);
    /*&gt;@*/

    /**
     * @constructor
     */
    function ContentProgressBar(config) {
        this.init(config);
    }

    ContentProgressBar.ATTRS = {

        /**
         * @attribute NAME
         * @type String
         */
        NAME: &#x27;ContentProgressBar&#x27;,

        /**
         * @attribute version
         * @type String
         */
        version: &#x27;1.0.41&#x27;,

        /**
         * @attribute configObject
         * @type Object
         */
        configObject: {},

        /**
         * @attribute node
         * @type HTMLElement
         */
        node: null,

        /**
         * Id if source Node
         * @attribute sourceId
         */
        sourceId: &#x27;&#x27;,

        /**
         * Dom Node which is synced with the progressBar
         * @attribute sourceNode
         */
        sourceNode: null,

        /**
         * Type of Dom Node which is synced with the progressBar. Video or Audio
         * @attribute sourceType
         */
        sourceType: &#x27;video&#x27;,

        /**
         * number of times we have tried to detect source Dom element
         * @attribute detectTimes
         */
        detectTimes: 0,

        /**
         * flag to make sure this sync only happen once
         * @attribute isSyncTargetToNode
         */
        isSyncTargetToNode: false,

        /**
         * flag to make sure this sync only happen once
         * @attribute isSyncNodeToTarget
         */
        isSyncNodeToTarget: false
    };

    /* Private methods */

    /**
     * Render the node from given config object, environment and orientation state
     *
     * @method renderContent
     * @private
     * @param {Object} configObject
     * @param {String} env
     * @param {String} orientation
     * @return {HTMLElement} node
     */
    function renderContent(configObject) {
        var node;
        if (document.createElement(&#x27;progress&#x27;).max === undefined) {
            /*@&lt;*/
            Debug.error(&#x27;[ ACT_contentProgressBar.js ]: progress tag is not supported by this browser&#x27;);
            /*&gt;@*/
            return null;
        }

        node = Dom.nodeCreate(&#x27;&lt;progress max=&quot;100&quot;&gt;&lt;/progress&gt;&#x27;).firstChild;
        node.id = configObject.id;

        // set class name
        if (Lang.isString(configObject.classNode)) {
            node.className += configObject.classNode;
        }

        // set tag attributes
        Dom.setAttributes(node, configObject.progressBarConfig);

        // set css styles
        Dom.applyStyles(node, configObject.css || {});

        /*@&lt;*/
        debugLog(&#x27;Generated node:&#x27;, node);
        /*&gt;@*/

        return node;
    }


    /* Public methods */
    Lang.extend(ContentProgressBar, [Capability, Class], {

        /**
         * Function auto initiated when the class is instantiated
         *
         * @method initializer
         * @public
         * @param {Object} config
         */
        initializer: function (config) {
            // save configObject reference
            this.set(&#x27;configObject&#x27;, config);

            /* istanbul ignore else */
            if (Lang.objHasKey(config, &#x27;progressBarConfig&#x27;) &amp;&amp; Lang.objHasKey(config.progressBarConfig, &#x27;sourceId&#x27;)) {
                this.set(&#x27;sourceId&#x27;, config.progressBarConfig.sourceId);
            }

            // detec Dom element of source Node
            this.detectSource();
        },

        /**
         * detech source element and type from its ID
         * @method detectSource
         */
        detectSource: function () {
            var root = this;
            var nodeId = root.get(&#x27;sourceId&#x27;);
            var node;

            /* istanbul ignore else */
            if (nodeId) {
                node = ACT.Dom.byId(nodeId);
                /*@&lt;*/
                debugLog(&#x27;try to get target DomElement&#x27; + node);
                /*&gt;@*/
                // if node is not available yet then we will try it again and again until it&#x27;s available
                /* istanbul ignore if */
                if (!Dom.isDomElement(node)) {
                    if (root.get(&#x27;detectTimes&#x27;) &lt; MAX_DETECT_TIMES) {
                        window.setTimeout(function () {
                            var counter = root.get(&#x27;detectTimes&#x27;);
                            root.set(&#x27;detectTimes&#x27;, counter++);
                            root.detectSource();
                        }, LEAP_DETECT_TIME);
                    }
                } else {
                    /*@&lt;*/
                    debugLog(&#x27;target node is available and ready&#x27;);
                    /*&gt;@*/
                    root.set(&#x27;sourceNode&#x27;, node);
                    root.set(&#x27;sourceType&#x27;, node.tagName.toLowerCase());
                    // sync progress of source node with value of progress bar
                    root.syncTargetToNode();
                }
            }
        },

        /**
         * Function called when the instance is destroyed
         *
         * @method destructor
         * @public
         */
        destructor: function () {
            var node = this.get(&#x27;node&#x27;);

            /* istanbul ignore else */
            if (Dom.isDomElement(node) &amp;&amp; node.parentNode) {
                // Event.purgeListeners(node);
                node.parentNode.removeChild(node);
            }
        },

        /**
         * Function generating the node &#x27;IMG&#x27;
         *
         * @method getContent
         * @public
         * @param {String} env Environment for rendering content such as html/flash/backup
         * @param {String} orientation Orientation of current device such as landscape and portraits for mobile
         * @return {HTMLElement} node
         */
        getContent: function (env, orientation) {
            var node = this.get(&#x27;node&#x27;);

            if (node === null) {
                node = renderContent(this.get(&#x27;configObject&#x27;), env, orientation);
                this.set(&#x27;node&#x27;, node);
                // reflect changes in node into the target Element
                this.syncNodeToTarget();
            }

            return {
                node: node
            };
        },

        /**
         * Listen to changes from the target element and update progressBar accordingly
         *
         * @method syncWithTargetNode
         */
        syncTargetToNode: function () {
            var root = this;
            var targetNode;
            var targetType;
            /* istanbul ignore if */
            if (this.get(&#x27;isSyncTargetToNode&#x27;) === true) {
                return;
            }

            targetNode = this.get(&#x27;sourceNode&#x27;);
            targetType = this.get(&#x27;sourceType&#x27;);

            // currently we only support video
            /* istanbul ignore else */
            if (targetNode &amp;&amp; targetType === &#x27;video&#x27;) {
                root.addEventListeners(
                    // listen to timeupdate event from target video then update progressbar accordingly
                    Event.on(&#x27;timeupdate&#x27;, function () {
                        var percentage = (targetNode.currentTime / targetNode.duration) * 100;
                        root.updateProgress(percentage);
                    }, targetNode, root)
                );
            }
            root.set(&#x27;isSyncTargetToNode&#x27;, true);
        },

        /**
         * Update target based on changes in progressBar
         *
         * @method syncWithTargetNode
         */
        syncNodeToTarget: function () {
            var root = this;
            /* istanbul ignore if */
            if (this.get(&#x27;isSyncNodeToTarget&#x27;) === true) {
                return;
            }

            root.addEventListeners(
                // listen to click on progress bar and update targetNode with new value
                Event.on(&#x27;click&#x27;, function (eventData) {
                    // get click position on progress bar
                    var percentage = root.getClickPosition(eventData);

                    // this detection must be inside event because highly chance that when click event is registered, the targetNode is not ready yet
                    var targetNode = root.get(&#x27;sourceNode&#x27;);
                    var targetType = root.get(&#x27;sourceType&#x27;);

                    // currently we only support video
                    /* istanbul ignore else */
                    if (targetNode &amp;&amp; targetType === &#x27;video&#x27;) {
                        /*@&lt;*/
                        debugLog(&#x27;click on progressbar, update video currentTime to &#x27; + percentage);
                        /*&gt;@*/
                        targetNode.currentTime = (targetNode.duration * percentage) / 100;
                        root.updateProgress(percentage);
                    }
                }, root.get(&#x27;node&#x27;), root)
            );

            root.set(&#x27;isSyncNodeToTarget&#x27;, true);
        },

        /**
         * Update current progress bar value
         * @method updateProgress
         * @attribte {String|Number} new value
         */
        updateProgress: function (newValue) {
            this.get(&#x27;node&#x27;).setAttribute(&#x27;value&#x27;, newValue);
        },

        /**
         * Get position of the click on progress bar and compare it with progress bar with to get the percentage
         * @method getClickPosition
         * @return {Number} percentage
         */
        getClickPosition: function (eventData) {
            var node = this.get(&#x27;node&#x27;);
            var nodeOffset = node.getBoundingClientRect();
            var percentage = 100 * (eventData.clientX - nodeOffset.left) / nodeOffset.width;
            return percentage;
        }
    });

    return ContentProgressBar;
});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
