<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/core/ACT_scaffolding.js - ACT.js</title>
    <link rel="stylesheet" href="https://s.yimg.com/zz/combo?yui-s:3.14.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="https://s.yimg.com/rz/l/favicon.ico">
    <script src="https://s.yimg.com/zz/combo?yui-s:3.14.1/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="https://s.yimg.com/cv/ae/global/ACTJS/logo/ACT.js.logo.png" title="ACT.js" width="150"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                            <li><a href="#api-demos">Demo and Examples</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ACT.html">ACT</a></li>
                                <li><a href="../classes/ActionsQueue.html">ActionsQueue</a></li>
                                <li><a href="../classes/Base.html">Base</a></li>
                                <li><a href="../classes/Capability.html">Capability</a></li>
                                <li><a href="../classes/CapabilitySkeleton.html">CapabilitySkeleton</a></li>
                                <li><a href="../classes/Class.html">Class</a></li>
                                <li><a href="../classes/ContentAdobeEdge.html">ContentAdobeEdge</a></li>
                                <li><a href="../classes/ContentCarousel.html">ContentCarousel</a></li>
                                <li><a href="../classes/ContentContainer.html">ContentContainer</a></li>
                                <li><a href="../classes/ContentHtml5.html">ContentHtml5</a></li>
                                <li><a href="../classes/ContentImage.html">ContentImage</a></li>
                                <li><a href="../classes/ContentProgressBar.html">ContentProgressBar</a></li>
                                <li><a href="../classes/ContentSwf.html">ContentSwf</a></li>
                                <li><a href="../classes/ContentThirdParty.html">ContentThirdParty</a></li>
                                <li><a href="../classes/ContentVideoFlash.html">ContentVideoFlash</a></li>
                                <li><a href="../classes/ContentVideoHtml.html">ContentVideoHtml</a></li>
                                <li><a href="../classes/ContentYoutube.html">ContentYoutube</a></li>
                                <li><a href="../classes/Cookie.html">Cookie</a></li>
                                <li><a href="../classes/CustomData.html">CustomData</a></li>
                                <li><a href="../classes/Debug.html">Debug</a></li>
                                <li><a href="../classes/Dom.html">Dom</a></li>
                                <li><a href="../classes/DwellTime.html">DwellTime</a></li>
                                <li><a href="../classes/Enabler.html">Enabler</a></li>
                                <li><a href="../classes/EnablerADTECH.html">EnablerADTECH</a></li>
                                <li><a href="../classes/EnablerConfig.html">EnablerConfig</a></li>
                                <li><a href="../classes/Environment.html">Environment</a></li>
                                <li><a href="../classes/Event.html">Event</a></li>
                                <li><a href="../classes/Flash.html">Flash</a></li>
                                <li><a href="../classes/IO.html">IO</a></li>
                                <li><a href="../classes/Json.html">Json</a></li>
                                <li><a href="../classes/Lang.html">Lang</a></li>
                                <li><a href="../classes/LayersList.html">LayersList</a></li>
                                <li><a href="../classes/LayerStandard.html">LayerStandard</a></li>
                                <li><a href="../classes/Scaffolding.html">Scaffolding</a></li>
                                <li><a href="../classes/Screen.html">Screen</a></li>
                                <li><a href="../classes/SecureDarla.html">SecureDarla</a></li>
                                <li><a href="../classes/StandardAd.html">StandardAd</a></li>
                                <li><a href="../classes/Tracking.html">Tracking</a></li>
                                <li><a href="../classes/UA.html">UA</a></li>
                                <li><a href="../classes/Util.html">Util</a></li>
                                <li><a href="../classes/VideoEvents.html">VideoEvents</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ACT.html">ACT</a></li>
                                <li><a href="../modules/actionsQueue.html">actionsQueue</a></li>
                                <li><a href="../modules/Base.html">Base</a></li>
                                <li><a href="../modules/CapabilitySkeleton.html">CapabilitySkeleton</a></li>
                                <li><a href="../modules/ContentAdobeEdge.html">ContentAdobeEdge</a></li>
                                <li><a href="../modules/ContentCarousel.html">ContentCarousel</a></li>
                                <li><a href="../modules/ContentContainer.html">ContentContainer</a></li>
                                <li><a href="../modules/ContentHtml5.html">ContentHtml5</a></li>
                                <li><a href="../modules/ContentImage.html">ContentImage</a></li>
                                <li><a href="../modules/ContentProgressBar.html">ContentProgressBar</a></li>
                                <li><a href="../modules/ContentSwf.html">ContentSwf</a></li>
                                <li><a href="../modules/ContentThirdParty.html">ContentThirdParty</a></li>
                                <li><a href="../modules/ContentVideoFlash.html">ContentVideoFlash</a></li>
                                <li><a href="../modules/ContentVideoHtml.html">ContentVideoHtml</a></li>
                                <li><a href="../modules/ContentYoutube.html">ContentYoutube</a></li>
                                <li><a href="../modules/Cookie.html">Cookie</a></li>
                                <li><a href="../modules/DwellTime.html">DwellTime</a></li>
                                <li><a href="../modules/Enabler.html">Enabler</a></li>
                                <li><a href="../modules/EnablerADTECH.html">EnablerADTECH</a></li>
                                <li><a href="../modules/environment.html">environment</a></li>
                                <li><a href="../modules/IO.html">IO</a></li>
                                <li><a href="../modules/LayersList.html">LayersList</a></li>
                                <li><a href="../modules/LayerStandard.html">LayerStandard</a></li>
                                <li><a href="../modules/Scaffolding.html">Scaffolding</a></li>
                                <li><a href="../modules/Screen.html">Screen</a></li>
                                <li><a href="../modules/SecureDarla.html">SecureDarla</a></li>
                                <li><a href="../modules/StandardAd.html">StandardAd</a></li>
                                <li><a href="../modules/Tracking.html">Tracking</a></li>
                            </ul>
                
                            <ul id="api-demos" class="apis demos">
                                <li><a href="../demo/ACT_Demo_300x250.html">300x250</a></li>
                                <li><a href="../demo/ACT_Demo_300x250_tracking.html">300x250_tracking</a></li>
                                <li><a href="../demo/ACT_Demo_TrackingExample.html">TrackingExample</a></li>
                                <li><a href="../demo/ACT_Demo_animation.html">animation</a></li>
                                <li><a href="../demo/ACT_Demo_billboard.html">billboard</a></li>
                                <li><a href="../demo/ACT_Demo_billboard-enabler.html">billboard-enabler</a></li>
                                <li><a href="../demo/ACT_Demo_billboard-expandable-enabler.html">billboard-expandable-enabler</a></li>
                                <li><a href="../demo/ACT_Demo_billboard_html_video.html">billboard_html_video</a></li>
                                <li><a href="../demo/ACT_Demo_billboard_html_video_rtl.html">billboard_html_video_rtl</a></li>
                                <li><a href="../demo/ACT_Demo_carousel.html">carousel</a></li>
                                <li><a href="../demo/ACT_Demo_dwelltime.html">dwelltime</a></li>
                                <li><a href="../demo/ACT_Demo_enabler_expand.html">enabler_expand</a></li>
                                <li><a href="../demo/ACT_Demo_enabler_fullscreen_expand.html">enabler_fullscreen_expand</a></li>
                                <li><a href="../demo/ACT_Demo_enabler_target.html">enabler_target</a></li>
                                <li><a href="../demo/ACT_Demo_floating.html">floating</a></li>
                                <li><a href="../demo/ACT_Demo_force_env.html">force_env</a></li>
                                <li><a href="../demo/ACT_Demo_html5_enabler.html">html5_enabler</a></li>
                                <li><a href="../demo/ACT_Demo_html5_standard.html">html5_standard</a></li>
                                <li><a href="../demo/ACT_Demo_icons.html">icons</a></li>
                                <li><a href="../demo/ACT_Demo_input_data.html">input_data</a></li>
                                <li><a href="../demo/ACT_Demo_login_html.html">login_html</a></li>
                                <li><a href="../demo/ACT_Demo_overwrite_env.html">overwrite_env</a></li>
                                <li><a href="../demo/ACT_Demo_splash_ad.html">splash_ad</a></li>
                                <li><a href="../demo/ACT_Demo_tablet_expandable.html">tablet_expandable</a></li>
                                <li><a href="../demo/ACT_Demo_video_event.html">video_event</a></li>
                                <li><a href="../demo/ACT_Demo_video_html.html">video_html</a></li>
                            </ul>
                
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/core/ACT_scaffolding.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
 * Copyright 2016, Yahoo Inc.
 * Copyrights licensed under the New BSD License.
 * See the accompanying LICENSE file for terms.
 */

/* global ACT */
/* eslint no-use-before-define: 0 */
/**
 * The &#x27;Scaffolding&#x27; is a core module made to parse the object layer to html.
 * This module is used in &#x27;layerStandard&#x27;.
 *
 * @module Scaffolding
 * @main Scaffolding
 * @class Scaffolding
 * @requires Lang, Class, Dom
 * @global
 */
ACT.define(&#x27;Scaffolding&#x27;, [/*@&lt;*/&#x27;Debug&#x27;, /*&gt;@*/ &#x27;Lang&#x27;, &#x27;Class&#x27;, &#x27;Dom&#x27;], function (ACT) {
    &#x27;use strict&#x27;;

    /* Shorthand */
    var Dom = ACT.Dom;
    var Lang = ACT.Lang;
    var Class = ACT.Class;

    /**
     * List of capabilities instances rendered, organized by layerName
     e.g {
        mpu: [
            {capability1},
            {capability2}
        ],
        expand: [
            {capability1},
            {capability2}
        ]
     }
     */
    var capabilityInstances = {};

    /**
     * temporary list for capabily instance
     */
    var temporaryInstances = [];

    /*@&lt;*/
    var Debug = ACT.Debug;
    Debug.log(&#x27;[ ACT_scaffolding.js ] Scaffolding Loaded&#x27;);
    /*&gt;@*/

    /**
     * @constructor
     */
    function Scaffolding(config) {
        this.init(config);
        // Scaffolding.superclass.constructor.apply(this, arguments);
    }

    Scaffolding.ATTRS = {
        /**
        * @attribute NAME
        * @type String
        */
        NAME: &#x27;Scaffolding&#x27;
    };

    /* Private methods */

    /**
     * Check screen size rules from env in config-object capabilities against current screen sizes
     *
     * @method checkSizes
     * @private
     * @param {Object} screenRules, Rule to be checked again screen size
     * @param {Object} status, the status object with current screen size
     * @return {Boolean}
     */
    function checkSizes(screenRules, status) {
        var result = true;
        /**
         * Go through all the rules defined in config object
         * if any if those rule is not satify then the size is not satisfy
         */
        Lang.forEach(screenRules, function (property, value) {
            switch (property) {
                case &#x27;min-width&#x27;:
                    // screen width must bigger than defined width
                    result = result &amp;&amp; parseInt(status.screenWidth, 10) &gt;= parseInt(value, 10);
                    break;
                case &#x27;min-height&#x27;:
                    // screen height must bigger than defined height
                    result = result &amp;&amp; parseInt(status.screenHeight, 10) &gt;= parseInt(value, 10);
                    break;
                case &#x27;max-width&#x27;:
                    // screen width must smaller than defined width
                    result = result &amp;&amp; parseInt(status.screenWidth, 10) &lt;= parseInt(value, 10);
                    break;
                case &#x27;max-height&#x27;:
                    // screen height must smaller than defined height
                    result = result &amp;&amp; parseInt(status.screenHeight, 10) &lt;= parseInt(value, 10);
                    break;
                default:
                    break;
            }
        });

        return result;
    }

    /**
     * Check if target screen size is suitable with current size
     *
     * @method isRightEnv
     * @private
     * @param {String | Array} targetResolution
     * @return {Boolean}
     */
    function isRightResolution(targetEnv, status, currentEnv) {
        /* example input:

        &#x27;targetEnv&#x27;: [{
            &#x27;backup&#x27;:{
                min-height: &#x27;300&#x27;,
                max-height: &#x27;600&#x27;,
                max-width: &#x27;1200&#x27;,
                min-width: &#x27;1000&#x27;
            }
        }]

        status: {
            orientation: &#x27;p&#x27;,
            screenHeight: &#x27;345&#x27;,
            screenWidth: &#x27;1073&#x27;
        }

        currentEnv = backup

         */
        var result = true;
        var index;
        var envRules;

        for (index = 0; index &lt; targetEnv.length; index++) {
            envRules = targetEnv[index];
            if (Lang.objHasKey(envRules, currentEnv) &amp;&amp; Lang.isObject(envRules[currentEnv])) {
                result = result &amp;&amp; checkSizes(envRules[currentEnv], status);
            }
        }

        return result;
    }

    /**
     * Check if target environment is suitable with current envt
     *
     * @method isRightEnv
     * @private
     * @param {Array} targetEnv
     * @param {String} current Enviroment
     * @return {Boolean}
     */
    function isRightEnv(targetEnv, currentEnv) {
        var result = false;
        var index;

        if (Lang.isArray(targetEnv)) {
            for (index in targetEnv) {
                if (targetEnv.hasOwnProperty(index)) {
                    if (Lang.isString(targetEnv[index]) &amp;&amp; targetEnv[index] === currentEnv) {
                        result = true;
                        break;
                    } else if (Lang.isObject(targetEnv[index]) &amp;&amp; currentEnv in targetEnv[index]) {
                        result = true;
                        break;
                    }
                }
            }
        }
        return result;
    }

    /**
     * Function to check given config object with environment and orientation and return if it is suitabe to be rendered
     *
     * @method isOkToRender
     * @private
     * @param {Object} refObj
     * @param {String} env
     * @param {String} status
     * @return {Boolean}
     */
    function isOkToRender(refObj, env, status) {
        refObj.env = refObj.env || env;

        if (!isRightEnv(refObj.env, env)) {
            return false;
        }

        if (!isRightResolution(refObj.env, status, env)) {
            return false;
        }

        if (refObj.orientation &amp;&amp; refObj.orientation !== status) {
            return false;
        }

        return true;
    }

    /**
     * Function to normalize the capability namespace. Example &#x27;content-container&#x27; to &#x27;ContentContainer&#x27;
     *
     * @method makeCapabilyNameSpace
     * @private
     * @param {String} capabilityName, string to remove dash and capitalise it
     * @return {String}
     **/
    function makeCapabilyNameSpace(capabilityNameTo) {
        var capabilityNameSpace = &#x27;&#x27;;
        var names = capabilityNameTo.split(&#x27;-&#x27;);
        var i;

        for (i = 0; i &lt; names.length; i++) {
            capabilityNameSpace += Lang.capitaliseFirstLetter(names[i]);
        }

        return capabilityNameSpace;
    }

    /**
     * Function to append a children to a given node html
     *
     * @method renderChildren
     * @private
     * @param {Object} container holder container
     * @param {Array} childrenObj list of children config object
     * @param {String} env
     * @param {String} orientation
     * @return {Object} container with children have been rendered inside
     */
    function renderChildren(container, childrenObj, env, status) {
        var i;
        for (i = 0; i &lt; childrenObj.length; i++) {
            container[childrenObj[i].id] = parseElement(childrenObj[i], env, status);
            if (container[childrenObj[i].id]) {
                container.appendChild(container[childrenObj[i].id]);
            }
        }
        return container;
    }

    /**
     * Function generated the child nodes content using capabilities
     *
     * @method parseElement
     * @private
     * recursive function to parse elements
     * @param {Object} refObj config object.
     * @param {String, Null, array} env for html element, i.e: html, flash, backup
     * @param {String} Orientation, render content capability against it
     **/
    function parseElement(refObj, env, status) {
        var capabilitySpaceName;
        var moduleInstance;
        var objFromNode;
        var container = &#x27;&#x27;;

        if (!isOkToRender(refObj, env, status)) {
            return false;
        }
        capabilitySpaceName = makeCapabilyNameSpace(refObj.type);
        /*@&lt;*/
        Debug.log(&#x27;[ ACT_scaffolding.js ] Loading Capability: &#x27;, capabilitySpaceName);
        /*&gt;@*/
        if (capabilitySpaceName in ACT) {
            moduleInstance = new ACT[capabilitySpaceName](refObj);
        } else {
            /* We need to throw a missing capability error here. */
            throw new Error(&#x27;Missing capability: &#x27; + capabilitySpaceName);
        }
        objFromNode = moduleInstance.getContent(env, status.orientation);

        if (objFromNode.node !== &#x27;undefined&#x27;) {
            container = objFromNode.node;
        }

        /* istanbul ignore next */
        if (Lang.isObject(objFromNode.content)) {
            refObj.content = Lang.merge(objFromNode.content, refObj.content);
        }

        if (Dom.isDomElement(container) &amp;&amp; Lang.isObject(refObj.content)) {
            container = renderChildren(container, refObj.content, env, status);
        }

        temporaryInstances.push(moduleInstance);
        return container;
    }

    /* Public methods */

    Lang.extend(Scaffolding, Class, {

        /**
         * Function auto initiated when the class is instantiated
         *
         * @method initializer
         * @public
         * @param {Object} config
         */
        initializer: function () {
            var htmlNode = this.parseHtml();
            return htmlNode;
        },

        /**
         * Function parsing the layer object to html
         *
         * @method parseHtml
         * @public
         * @return {String} raw Html
         */
        parseHtml: function () {
            var rawHtml;
            // clean the temporary list so it can be used to store a new list
            temporaryInstances = [];

            // parseElement will add new capability instance into temp
            rawHtml = parseElement(
                this.get(&#x27;refObj&#x27;),
                this.get(&#x27;env&#x27;),
                this.get(&#x27;status&#x27;)
            );

            this.set(&#x27;htmlParsed&#x27;, rawHtml);

            // update capability instances list
            capabilityInstances[this.get(&#x27;layerName&#x27;)] = temporaryInstances;

            return {
                rawHtml: rawHtml,
                capabilityInstances: capabilityInstances[this.get(&#x27;layerName&#x27;)]
            };
        },

        /**
         * Function getter for the content html parsed
         *
         * @method getHtmlParsered
         * @public
         */
        getHtmlParsered: function () {
            if (this.get(&#x27;htmlParsed&#x27;)) {
                /*@&lt;*/
                Debug.log(&#x27;[ ACT_scaffolding.js ] html parsered : &#x27;, this.get(&#x27;htmlParsed&#x27;));
                /*&gt;@*/

                return {
                    rawHtml: this.get(&#x27;htmlParsed&#x27;),
                    capabilityInstances: capabilityInstances[this.get(&#x27;layerName&#x27;)]
                };
            }
            /*@&lt;*/
            Debug.log(&#x27;[ ACT_scaffolding.js ] no html parsered&#x27;);
            /*&gt;@*/
            return this.parseHtml();
        }
    });

    return Scaffolding;
});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
